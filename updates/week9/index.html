<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 9 · Sensors for Restoration</title>
  <link rel="stylesheet" href="../../style.css" />
</head>
<body>
  <header>
    <h1>Project Updates — Week 9</h1>
    <nav>
      <a href="../../index.html">Home</a>
      <a href="../../updates.html">Updates</a>
      <a href="../../forum.html">Forum</a>
      <a href="../../about.html">About</a>
      <a href="../../contact.html">Contact</a>
    </nav>
  </header>
  <main>
    <article class="card update">
      <h3>Week 9 Team Updates</h3>
      <p><b>Housing</b></p>
      <p>Started to create a 3d model of the whole sensor to test its boyuconcy on Fusion.</p>
      <img src="Cad_picture.png" alt="Cad_picture" style="object-fit: cover; height: 400px;">
      <img src="Cad_picture2.png" alt="Cad_picture2" style="object-fit: cover; height: 400px;">
      <p> Additionally, added masses and altered the volumes to fit the measurements made in class, along with the material types of each.
        Currently working on the simulation part - found center of mass and center of gravity - currently figuring out how to model the actual buoyancy
        and simulate in fusion</p>
      <p><b>Salinity (new)</b></p>
      <p>
        Gathered data on Friday comparing resistance to known salinity, but upon comparison to older data from materials tests realized the standard deviations & values were off. I am reasonably certain it has to do with the code. I don't think Friday's data is terrible, but if there is time, redoing the test with the new code might be beneficial in having a more accurate salinity/resistance map. 
      </p>

      <h4>New Salinity Code:</h4>
      <p>
        int voltPin = 32;
        int dtime = 250;
        int raw = 0;
        float Vin = 3.3;
        float Vout = 0;
        float R1 = 1000;
        float R2 = 0;
        float buff = 0;
        float avg = 0;
        int samples = 5000;
        int outputPinBlue = 23;
        int outputPinRed = 33;

        void setup(){
          pinMode(outputPinRed,OUTPUT); 
          pinMode(outputPinBlue,OUTPUT);
          pinMode(voltPin, INPUT);
          Serial.begin(115200); // start serial
        }

        void loop() {
          float tot = 0;

          for (int i = 0; i < samples; i++) {

            // --- Phase 1: +V ---
            digitalWrite(outputPinBlue, HIGH);
            digitalWrite(outputPinRed, LOW);
            delayMicroseconds(dtime);
            int rawPos = analogRead(voltPin);    // read in middle of +V phase
            delayMicroseconds(dtime);

            // --- Phase 2: -V ---
            digitalWrite(outputPinBlue, LOW);
            digitalWrite(outputPinRed, HIGH);
            delayMicroseconds(dtime);
            int rawNeg = analogRead(voltPin);    // read in middle of -V phase
            delayMicroseconds(dtime);

            // Convert raw readings to resistance
            float rawAvg = (rawPos + rawNeg) / 2.0;

            float Vout = (rawAvg * Vin) / 4096.0;
            float R2 = R1 * ((Vin / Vout) - 1.0);

            tot += R2;
          }

          avg = tot / samples;
          Serial.print(avg);
          Serial.println(" Ohms");
        }
      </p>
      
      <p><b>Salinity</b></p>
      <p>Tested resistance vs. known salinity of a fluid using a microwave to heat the water and dissolve the salts better. Discovered issues with water leaking into the experimental setup, which might've thrown off our data. Planning to run additional tests with more waterproofing.</p>
      <p>Currently using temporary code that sends current in one direction. New code that reads more samples and sends alternating current is a next step.</p>
      <h4> Code: </h4>
      <p>
        const int voltPin = 32;
        const int outputPinRed = 33;
        const int outputPinBlue = 23;
        double deltaV;

        const int R2 = 1000;
        const double totalVoltage = 3.3;


        void setup() {
          pinMode(voltPin, INPUT);
          pinMode(outputPinRed, OUTPUT);
          pinMode(outputPinBlue, OUTPUT);
          Serial.begin(115200);

        }

        void loop() {
          // Alternating current 
          digitalWrite(outputPinRed, HIGH);
          digitalWrite(outputPinBlue, LOW);
          
          
          // Find current using voltage drop across R2
          deltaV = analogRead(voltPin);
          deltaV *= 3.3;
          deltaV /= 4096.0;
          Serial.println(deltaV);
          double current = deltaV / R2;

          // Find R1 
          double remainingVoltage = totalVoltage - deltaV;
          double R1 = remainingVoltage / current;
          Serial.printf("R1 is %f\n", R1);

          // wait
          delay(1000); 
        }
      </p>

      <p><b>Depth Sensor Comparison </b></p>
      
      <table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Sensor</th>
      <th>Cost</th>
      <th>Claimed Depth Range</th>
      <th>Measured Depth Range</th>
      <th>Claimed Accuracy</th>
      <th>Measured Accuracy</th>
      <th>Product Link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>JSN-SR04T</td>
      <td>$9</td>
      <td>~0.25–4 m (per listing)</td>
      <td>TBD</td>
      <td>~5 mm resolution (per listing)</td>
      <td>TBD</td>
      <td><a href="https://www.amazon.com/HiLetgo-Integrated-Ultrasonic-Transducer-Waterproof/dp/B07X5H77T7/">Product link</a></td>
    </tr>
    <tr>
      <td>"Superior" Underwater Distance Sensor</td>
      <td>$36</td>
      <td>Up to ~6 m (per listing)</td>
      <td>TBD</td>
      <td>Within 2 m: ±(0.5 + D×0.5%); beyond 2 m: ±(1 + D×1%) (per listing)</td>
      <td>TBD</td>
      <td><a href="https://www.amazon.com/dp/B0CL58CP26">Product link</a></td>
    </tr>
    <tr>
      <td>TL‑136</td>
      <td>$40</td>
      <td>0-3 m</td>
      <td>TBD</td>
      <td>±1–3 cm</td>
      <td>TBD</td>
      <td><a href="https://www.amazon.com/dp/B0C448QTPV">Product link</a></td>
    </tr>
  </tbody>
</table>



    </article>
    
  </main>
  <footer>© <span id="y"></span> Sensors for Restoration</footer>
  <script>document.getElementById('y').textContent = new Date().getFullYear();</script>
</body>
</html>
